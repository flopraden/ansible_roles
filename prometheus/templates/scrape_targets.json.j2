[
  {% for group in item.groups |default([])| sort %}
  {
    "targets": [
{% for host in groups.get(group,[])|sort|unique|list%}
        "{{host}}:{{item.port}}"{{"" if loop.last else ","}}
{% endfor %}
    ],
    "labels": {
      "monitoring_group":  "{{ item.name }}"
    }
  },
  {% endfor %}
  {% if item.targets | default(false, true) %}
  {
    "targets": {{ item.targets | to_json }},
    "labels": {
      "monitoring_group":  "{{ item.name }}"
    }
  },
  {% endif %}
  {"targets": []}
]
